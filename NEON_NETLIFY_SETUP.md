# Настройка Neon PostgreSQL для Netlify

## Обзор

Этот гайд поможет настроить ваш интернет-магазин Game Store для работы с Neon PostgreSQL на Netlify.

## Шаг 1: Получение URL базы данных из Neon

### 1.1 Войдите в панель управления Neon
1. Перейдите на [https://console.neon.tech/](https://console.neon.tech/)
2. Войдите в свой аккаунт
3. Выберите проект, который используется для вашего приложения

### 1.2 Найдите Connection Details
1. В панели Neon найдите раздел **Connection Details**
2. Скопируйте **Connection string** (он будет выглядеть примерно так):
   ```
   postgresql://daniel:secret@ep-cool-name-123456.us-east-2.aws.neon.tech/gamestore?sslmode=require
   ```

### 1.3 Проверьте параметры подключения
Убедитесь, что в URL присутствуют:
- Правильное имя пользователя и пароль
- Хост (ep-...neon.tech)
- Имя базы данных (gamestore)
- Параметр `sslmode=require` (обязательно для Neon)

## Шаг 2: Настройка переменных окружения на Netlify

### 2.1 Перейдите в панель Netlify
1. Откройте [https://app.netlify.com/](https://app.netlify.com/)
2. Выберите ваш сайт: `chic-cactus-2776a1`

### 2.2 Добавьте переменные окружения
1. Перейдите в **Site settings → Build & deploy → Environment → Environment variables**
2. Нажмите **Add variable**
3. Добавьте следующие переменные:

#### Обязательные переменные:
| Variable | Value | Пример |
|----------|-------|--------|
| `DATABASE_URL` | Connection string из Neon | `postgresql://user:password@ep-cool-name-123456.us-east-2.aws.neon.tech/gamestore?sslmode=require` |
| `NEXTAUTH_SECRET` | Секрет для NextAuth | `b5Jj2BL9yXoyPYA4MFegjOJkPVHyh8fEKBiaXhXzZMg=` |
| `NEXTAUTH_URL` | URL вашего сайта | `https://chic-cactus-2776a1.netlify.app` |

#### Опциональные переменные (если используете Stripe):
| Variable | Value | Примечание |
|----------|-------|------------|
| `STRIPE_SECRET_KEY` | `sk_test_...` | Только для тестирования |
| `STRIPE_PUBLISHABLE_KEY` | `pk_test_...` | Только для тестирования |
| `STRIPE_WEBHOOK_SECRET` | `whsec_...` | Только для тестирования |

### 2.3 Проверьте настройки сборки
1. Перейдите в **Site settings → Build & deploy**
2. Убедитесь, что указаны:
   - **Build command:** `npm run build`
   - **Publish directory:** `.next`
   - **Node version:** 18 или выше

## Шаг 3: Перезапуск деплоя

### 3.1 Очистка кэша и пересборка
1. Перейдите в раздел **Deploys**
2. Нажмите **Trigger deploy**
3. Выберите **Clear cache and deploy site**
4. Дождитесь завершения сборки

### 3.2 Проверка логов
1. После завершения деплоя проверьте **Deploy log**
2. Ищите сообщения об успешном подключении к базе данных
3. Если есть ошибки, проверьте:
   - Правильность URL базы данных
   - Наличие SSL параметра
   - Доступность базы данных из интернета

## Шаг 4: Проверка работы приложения

### 4.1 Проверка подключения к базе данных
1. Откройте ваш сайт: [https://chic-cactus-2776a1.netlify.app/](https://chic-cactus-2776a1.netlify.app/)
2. Проверьте, что страницы загружаются без ошибок
3. Попробуйте зарегистрироваться и авторизоваться

### 4.2 Проверка функциональности
1. Проверьте работу каталога игр
2. Проверьте добавление товаров в корзину
3. Проверьте работу админ-панели (если есть доступ)

## Решение распространенных проблем

### Проблема: Ошибка подключения к базе данных
**Решение:**
1. Проверьте, что URL базы данных скопирован полностью
2. Убедитесь, что параметр `sslmode=require` присутствует
3. Проверьте, что база данных доступна из интернета (Neon по умолчанию разрешает подключения)

### Проблема: Ошибка SSL
**Решение:**
1. Убедитесь, что в URL присутствует `?sslmode=require`
2. Проверьте, что вы используете HTTPS URL для подключения

### Проблема: Ошибка аутентификации
**Решение:**
1. Проверьте правильность логина и пароля
2. Убедитесь, что пользователь имеет права на базу данных
3. Попробуйте пересоздать пользователя в Neon

### Проблема: Ошибка миграций
**Решение:**
1. Убедитесь, что база данных пустая или содержит правильную схему
2. Проверьте, что миграции Prisma применены
3. При необходимости создайте новые миграции

## Важные замечания

1. **Никогда не используйте localhost** в продакшен-окружении
2. **Всегда используйте SSL** для подключения к базе данных
3. **Храните секретные ключи** в переменных окружения, а не в коде
4. **Регулярно проверяйте логи** после деплоя
5. **Используйте отдельные базы данных** для разработки и продакшена

## Поддержка

Если возникнут проблемы:
1. Проверьте логи деплоя на Netlify
2. Проверьте логи базы данных в Neon
3. Обратитесь в поддержку Netlify с логами и описанием проблемы
4. Обратитесь в поддержку Neon при проблемах с подключением к базе данных